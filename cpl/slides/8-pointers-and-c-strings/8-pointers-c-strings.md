---
presentation:
  margin: 0
  center: false
  transition: "convex"
  enableSpeakerNotes: true
  slideNumber: "c/t"
  navigationMode: "linear"
---

@import "../../css/font-awesome-4.7.0/css/font-awesome.css"
@import "../../css/theme/solarized.css"
@import "../../css/logo.css"
@import "../../css/font.css"
@import "../../css/color.css"
@import "../../css/margin.css"
@import "../../css/table.css"
@import "../../css/main.css"
@import "../../plugin/zoom/zoom.js"
@import "../../plugin/customcontrols/plugin.js"
@import "../../plugin/customcontrols/style.css"
@import "../../plugin/chalkboard/plugin.js"
@import "../../plugin/chalkboard/style.css"
@import "../../plugin/menu/menu.js"
@import "../../js/anychart/anychart-core.min.js"
@import "../../js/anychart/anychart-venn.min.js"
@import "../../js/anychart/pastel.min.js"
@import "../../js/anychart/venn-ml.js"


<!-- slide data-notes="" -->

<div class="bottom20"></div>

# Cè¯­è¨€ç¨‹åºè®¾è®¡åŸºç¡€

<hr class="width50 center">

## æŒ‡é’ˆ++


<div class="bottom8"></div>

### è®¡ç®—æœºå­¦é™¢ &nbsp;&nbsp; æ¨å·²å½ª

### yangyibiao@nju.edu.cn



<!-- slide vertical=true data-notes="" -->

##### æçº²

---

- å›é¡¾pointer

- malloc/free

- å­—ç¬¦æ•°ç»„

---


<!-- slide vertical=true data-notes="" -->

##### å›é¡¾

---

  <img src="figs/pointer-in-c.png" style="max-width:500px; height:auto; flex-shrink:0;">

---


<!-- slide vertical=true data-notes="" -->

##### å›é¡¾

---

- **æŒ‡é’ˆç±»å‹**
  - `int *`
  - `char *`

- **æŒ‡é’ˆä½¿ç”¨**
  - `*` é—´æ¥å¯»å€
  - `&` å–åœ°å€

- **æŒ‡é’ˆè¿ç®—**
  - `++` çš„å«ä¹‰

ğŸ“„ ç¤ºä¾‹ä»£ç ï¼š[chat_int.c](./code/char_int.c)

---


<!-- slide vertical=true data-notes="" -->

##### å¯è§†åŒ–ç†è§£æŒ‡é’ˆ

---

[Understanding "pointer", visually, Visualize Code Execution](https://pythontutor.com/c.html)

[pointer_understand.c](./code/pointer_understand.c)

---


<!-- slide vertical=true data-notes="" -->

##### å †/æ ˆ

---

<div style="display:flex; align-items:flex-start; justify-content:space-between;">

  <img src="figs/program_layout_in_memory.png" width="300px" style="margin-left:20px;">
<div>

- textï¼ˆä»£ç åŒºï¼‰ï¼šå­˜æ”¾ç¨‹åºçš„æœºå™¨æŒ‡ä»¤

- dataï¼ˆå·²åˆå§‹åŒ–çš„é™æ€å­˜å‚¨åŒºï¼‰ï¼šå­˜æ”¾å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€staticå˜é‡

- bssï¼ˆæœªåˆå§‹åŒ–çš„é™æ€å­˜å‚¨åŒºï¼‰ï¼šå­˜æ”¾æœªåˆå§‹åŒ–æˆ–åˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡ã€staticå˜é‡

- heapï¼ˆå †ï¼‰ï¼šåŠ¨æ€åˆ†é…åŒºåŸŸ, ç”± malloc/free ç®¡ç†, å†…éƒ¨æ˜¯å¦è¿ç»­å–å†³äºå®ç°ï¼ˆé€»è¾‘ä¸Šè¿ç»­ï¼‰

- stackï¼ˆæ ˆï¼‰ï¼šç”±å‡½æ•°è°ƒç”¨äº§ç”Ÿæ ˆå¸§, å¤§å°å›ºå®šï¼ˆçº¿ç¨‹åˆ›å»ºæ—¶å†³å®šï¼‰**å†…å­˜è¿ç»­ï¼ŒæŒ‰åœ°å€ä¸‹é™ï¼ˆå¤šæ•°æ¶æ„ï¼‰**



</div>

</div>


---


<!-- slide vertical=true data-notes="" -->

##### å †/æ ˆ

---

<img src="figs/program_layout2.png" width="400px" style="margin-left:20px;">

```C
int a = 10;      // data æ®µ
int b;           // bss æ®µï¼ˆè‡ªåŠ¨åˆå§‹åŒ–ä¸º0ï¼‰

static int s1 = 5; // data æ®µ
static int s2;     // bss æ®µ

char *p = "Hello"; // text æ®µï¼ˆå­—ç¬¦ä¸²å¸¸é‡ï¼‰
```

---


<!-- slide vertical=true data-notes="" -->

##### å‡½æ•°è°ƒç”¨æ ˆ

---

æ ˆé¡¶ï¼ˆä½åœ°å€ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ frame of func C   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ frame of func B   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ frame of func A   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   main frame      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ ˆåº•ï¼ˆé«˜åœ°å€ï¼‰

æ¯æ¬¡å‡½æ•°è°ƒç”¨åªæ˜¯å¾€æ ˆé‡Œ push ä¸€ä¸ªæ ˆå¸§ï¼Œå‡½æ•°è¿”å›æ—¶å°±popã€‚

---


<!-- slide vertical=true data-notes="" -->

##### å‡½æ•°è°ƒç”¨æ ˆ

---

â€œçº¿ç¨‹çš„æ ˆå¤§å°â€æ˜¯å›ºå®šçš„

ä¾‹å¦‚ï¼š

Linux é»˜è®¤çº¿ç¨‹æ ˆå¤§å°ï¼š8MB


å‡½æ•°æ ˆå¤§å°å–å†³äºï¼š

- å‚æ•°å‹æ ˆ

- è¿”å›åœ°å€

- å±€éƒ¨å˜é‡å¤§å°

- ä¿å­˜å¯„å­˜å™¨

- ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆæ¯”å¦‚å°¾é€’å½’ä¼˜åŒ–ï¼‰

---


<!-- slide vertical=true data-notes="" -->

##### å‡½æ•°è°ƒç”¨æ ˆ

---
ç”³è¯·è¶…å¤§æ•°ç»„
```C
void foo() {
  int bigArray[100000000]; // 400MBï¼Œè¿œè¶…é»˜è®¤1â€“8MBæ ˆ
}

int main() {
  foo();
  return 0;
}
```
ä¼šè§¦å‘ï¼š
```
Segmentation fault (stack overflow)
```

---


<!-- slide vertical=true data-notes="" -->

##### åŠ¨æ€å†…å­˜åˆ†é…

---

- å¯å˜é•¿æ•°ç»„ `int arr[n]`ï¼ˆVariable Length Arrayï¼‰

- ä¸æ¨èä½¿ç”¨VLA
  - VLAåˆ†é…åœ¨æ ˆä¸Š/æ ˆç©ºé—´é€šå¸¸æœ‰é™
  - æ— æ³•è¿›è¡Œé™æ€è¾¹ç•Œæ£€æŸ¥/é™æ€åˆ†æå·¥å…·éš¾ä»¥æ¨æ–­è¾¹ç•Œ
  - ç¼–è¯‘å™¨ä¼˜åŒ–å›°éš¾

```C
int n;
scanf("%d", &n);
int arr[n]; 
// è‹¥néå¸¸å¤§ï¼Œç›´æ¥æ ˆæº¢å‡ºï¼Œæ¯” malloc() åˆ†é…å¤±è´¥æ›´éšè”½ï¼Œä¸”éš¾ä»¥æ£€æµ‹
```

---


<!-- slide vertical=true data-notes="" -->

##### åŠ¨æ€å†…å­˜åˆ†é…

---

`malloc`å’Œ`free`

Cå‡½æ•°åº“æä¾›`malloc`å’Œ`free`ï¼Œåˆ†åˆ«ç”¨äºæ‰§è¡ŒåŠ¨æ€å†…å­˜çš„==åˆ†é…==ä¸==é‡Šæ”¾==

```C{.line-numbers}
int *arr = NULL;
int n = 10;
// åŠ¨æ€åˆ†é…å¯ä»¥å­˜æ”¾10ä¸ªæ•´æ•°çš„å†…å­˜ç©ºé—´
arr = (int*)malloc(n * sizeof(int));
// TODO
free(arr);
```

---


<!-- slide vertical=true data-notes="" -->

##### å†…å­˜åˆ†é…å‡½æ•°malloc

---

```C{.line-numbers}
#include <stdlib.h>
void *malloc(size_t _Size);
```

å‘`malloc`ç”³è¯·çš„ç©ºé—´çš„å¤§å°æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„
è¿”å›ç±»å‹é»˜è®¤æ˜¯`void *`

```C
int *array = (int *) malloc(len * sizeof(int))
int *array = malloc(len * sizeof(int))
int *array = malloc(len * sizeof(*array))
```

[malloc.c](./code/malloc.c)

- åˆ†é…å¤±è´¥åˆ™è¿”å›NULLä¾¿äºåç»­å¤„ç†
- ä¸arr[n]è¿‡å¤§åˆ™ç›´æ¥æ ˆæº¢å‡º

---


<!-- slide vertical=true data-notes="" -->

##### å†…å­˜é‡Šæ”¾å‡½æ•°free

---

```C
#include<stdlib.h>
void free(void *pointer);
```

free(ptr):é‡Šæ”¾æŒ‡é’ˆæŒ‡å‘å†…å­˜ï¼ŒæŒ‡é’ˆå˜é‡ä¾ç„¶å­˜åœ¨(é‡æŒ‡é’ˆ)

ä¸ºé˜²æ­¢é‡Šæ”¾åå†™, å»ºè®® ptr = NULL

- éœ€è¦é‡Šæ”¾ä¹‹å‰åŠ¨æ€ç”³è¯·çš„å†…å­˜, ä¸€å¯¹ä¸€é…å¯¹ä½¿ç”¨
- å†…å­˜æ³„æ¼memory leak

[malloc_space.c](./code/malloc_space.c)

---


<!-- slide vertical=true data-notes="" -->

##### åŠ¨æ€å†…å­˜åˆ†é…çš„å¸¸è§é”™è¯¯

---

- ç”³è¯·äº†æ²¡æœ‰free

- å¯¹NULLæŒ‡é’ˆè¿›è¡Œè§£å¼•ç”¨

- å¯¹åˆ†é…çš„å†…å­˜è¶Šç•Œæ“ä½œ

- é‡Šæ”¾å¹¶éåŠ¨æ€åˆ†é…çš„å†…å­˜ï¼ˆæ®µé”™è¯¯ï¼‰free array

- è¯•å›¾é‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜çš„éƒ¨åˆ†

- é‡Šæ”¾åä¾æ—§è¯•å›¾ç»§ç»­ä½¿ç”¨

- double free

[malloc_bugs.c](./code/malloc_bugs.c)

---


<!-- slide vertical=true data-notes="" -->

##### ä¸€äº›å…¶ä»–memory allocationå‡½æ•°

---

```C
void *malloc(size_t size);
void *calloc(size_t nitems, size_t size); // åˆ†é…çš„æ—¶å€™ç½®0
void *realloc(void *ptr, size_t new_size); // æ‰©å®¹
void free(void *ptr);
```

- malloc: allocates memory

- calloc: allocates and zeros memory

- realloc: expands previously allocated memory block

- free deallocates previoulsy allocated memory

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦æ•°ç»„

---

æ¶µç›–==å­—ç¬¦ä¸²å¸¸é‡==å’Œ==å­—ç¬¦ä¸²å˜é‡==. 

å­—ç¬¦ä¸²å¸¸é‡åœ¨Cæ ‡å‡†ä¸­ç§°ä¸ºå­—ç¬¦ä¸²å­—é¢é‡.

å­—ç¬¦ä¸²æ˜¯å­—ç¬¦æ•°ç»„, ç”¨ç‰¹æ®Šå­—ç¬¦(ç©ºå­—ç¬¦)æ ‡è®°ç»“æŸ. 

Cåº“æä¾›äº†ä¸€ç»„ç”¨äºå¤„ç†å­—ç¬¦ä¸²çš„å‡½æ•°. 

---


<!-- slide vertical=true id="strliteralsr" data-notes="" -->

##### å­—ç¬¦ä¸²å­—é¢é‡

---

å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦åºåˆ—: 

`"Talk is cheap. Show me the code."`

å­—ç¬¦ä¸²å­—é¢é‡å¯èƒ½åŒ…å«è½¬ä¹‰åºåˆ—. 

è½¬ä¹‰å­—ç¬¦ç»å¸¸å‡ºç°åœ¨printfå’Œscanfæ ¼å¼å­—ç¬¦ä¸²ä¸­. 

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²å­—é¢é‡

---

ä¾‹å¦‚, å­—ç¬¦ä¸²

`"520\nNJU"`

æ¯ä¸ª\nå­—ç¬¦ä½¿å…‰æ ‡ç§»åˆ°ä¸‹ä¸€è¡Œ: 
```C
520
NJU
```

---


<!-- slide data-notes="" -->

##### å­—ç¬¦ä¸²å­—é¢é‡

---

åæ–œæ å­—ç¬¦(`\`)å¯ç”¨äºå°†å­—ç¬¦ä¸²å­—é¢é‡ä»ä¸€è¡Œå»¶ç»­åˆ°ä¸‹ä¸€è¡Œ: 
```C
printf("When you come to a fork in the road, take it.  \
--Yogi Berra");
```

é€šå¸¸, `\`å­—ç¬¦å¯ç”¨äºå°†ç¨‹åºçš„ä¸¤è¡Œæˆ–å¤šè¡Œè¿æ¥æˆä¸€è¡Œ. 

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²å­—é¢é‡

---

ä¸€ç§æ›´å¥½çš„å¤„ç†é•¿å­—ç¬¦ä¸²å­—é¢é‡çš„æ–¹æ³•:  

å½“ä¸¤ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²å­—é¢é‡ç›¸é‚»æ—¶, ç¼–è¯‘å™¨ä¼šå°†å®ƒä»¬è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸². 

æ­¤è§„åˆ™å…è®¸æˆ‘ä»¬å°†å­—ç¬¦ä¸²å­—é¢é‡æ‹†åˆ†ä¸ºä¸¤è¡Œæˆ–å¤šè¡Œ: 

```C
printf("When you come to a fork in the road, take it. "
       "--Yogi Berra");
```

---


<!-- slide vertical=true data-notes="" -->

##### å¦‚ä½•å­˜å‚¨å­—ç¬¦ä¸²å­—é¢é‡

---

å½“Cç¼–è¯‘å™¨åœ¨ç¨‹åºä¸­é‡åˆ°é•¿åº¦ä¸º ==$n$== çš„å­—ç¬¦ä¸²å­—é¢é‡æ—¶, å®ƒä¼šä¸ºè¯¥å­—ç¬¦ä¸²åˆ†é… ==$n + 1$== ä¸ªå­—èŠ‚çš„å†…å­˜. 

è¿™å—å†…å­˜ç©ºé—´å°†ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦, ä»¥åŠä¸€ä¸ªé¢å¤–çš„å­—ç¬¦: 
==ç©ºå­—ç¬¦== æ ‡è®°å­—ç¬¦ä¸²çš„ç»“å°¾. 

ç©ºå­—ç¬¦æ˜¯æ‰€æœ‰ä½éƒ½ä¸º0çš„å­—èŠ‚, å› æ­¤å®ƒç”¨è½¬ä¹‰åºåˆ— =='\0'== è¡¨ç¤º. 

---


<!-- slide vertical=true data-notes="" -->

##### å¦‚ä½•å­˜å‚¨å­—ç¬¦ä¸²å­—é¢é‡

---

å­—ç¬¦ä¸²å­—é¢é‡"abc"å­˜å‚¨ä¸º4ä¸ªå­—ç¬¦çš„æ•°ç»„: 

<div class="top-2">
  <img src="img/14-1.png" height=100px>
</div>

å­—ç¬¦ä¸²""(ç©ºä¸²)ä¼šå­˜å‚¨ä¸€ä¸ªç©ºå­—ç¬¦: 
<div class="top-2">
  <img src="img/14-2.png" height=100px>
</div>

==æ³¨æ„==: åŒºåˆ«ç©ºå­—ç¬¦å’Œç©ºæ ¼å­—ç¬¦

---

<!-- slide data-notes="" -->

##### å¦‚ä½•å­˜å‚¨å­—ç¬¦ä¸²å­—é¢é‡

---

å­—ç¬¦ä¸²å­—é¢é‡å­˜å‚¨ä¸ºæ•°ç»„, ç¼–è¯‘å™¨å°†å…¶è§†ä¸º`char *`ç±»å‹çš„æŒ‡é’ˆ.

printfå’Œscanféƒ½éœ€è¦ä¸€ä¸ª`char *`ç±»å‹çš„å€¼ä½œä¸ºå®ƒä»¬ç¬¬ä¸€ä¸ªå‚æ•°. 

printfå‡½æ•°ä¼ é€’"abc"çš„åœ°å€(æŒ‡å‘å­—æ¯aå†…å­˜ä¸­å­˜å‚¨ä½ç½®çš„æŒ‡é’ˆ): 

```C
printf("abc");
```

---

<!-- slide vertical=true data-notes="" -->

##### å¯¹å­—ç¬¦ä¸²å­—é¢é‡çš„æ“ä½œ

---

å¯ä»¥åœ¨ä»»ä½•å…è®¸ä½¿ç”¨`char *`æŒ‡é’ˆçš„åœ°æ–¹ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡: 

```C
char *p;
p = "abc"; /* æ­£ç¡® */
```

è¯¥èµ‹å€¼ä½¿pæŒ‡å‘å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦. 

---


<!-- slide vertical=true data-notes="" -->

##### å¯¹å­—ç¬¦ä¸²å­—é¢é‡çš„æ“ä½œ

---

å¯ä»¥å¯¹å­—ç¬¦ä¸²å­—é¢é‡å–ä¸‹æ ‡: 

```C
char ch;
ch = "abc"[1];  // ch is now 'b'
```

å°† 0 ~ 15 çš„æ•°å­—è½¬æ¢ä¸ºç­‰ä»·çš„åå…­è¿›åˆ¶çš„å­—ç¬¦å½¢å¼çš„å‡½æ•°: 

```C
char digit_to_hex_char(int digit)
{
  return "0123456789ABCDEF"[digit];
}
```

---


<!-- slide vertical=true data-notes="" -->



##### å¯¹å­—ç¬¦ä¸²å­—é¢é‡çš„æ“ä½œ

---

å°è¯•ä¿®æ”¹å­—ç¬¦ä¸²å­—é¢é‡ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸º: 

```C
char *p = "abc";
*p = 'd';   /*** WRONG ***/
```

å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–è¡Œä¸ºå¼‚å¸¸. 

---


<!-- slide data-notes="" -->

##### å­—ç¬¦ä¸²å­—é¢é‡ä¸å­—ç¬¦å¸¸é‡

---

åŒ…å«å•ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²å­—é¢é‡ä¸å­—ç¬¦å¸¸é‡ä¸åŒ. 

- `"a"`ç”±==æŒ‡é’ˆ==è¡¨ç¤º. 

- `'a'`ç”±==æ•´æ•°==è¡¨ç¤º. 

åˆæ³•è°ƒç”¨: 
```C
printf("\n");
```

éæ³•è°ƒç”¨: 
```C
printf('\n'); /*** é”™è¯¯çš„ ***/
```

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²å˜é‡

---

ä»»ä½•ä¸€ç»´å­—ç¬¦æ•°ç»„éƒ½å¯ä»¥ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸². 

å­—ç¬¦ä¸²å¿…é¡»ä»¥ç©ºå­—ç¬¦ç»“å°¾. 

æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²çš„éš¾ç‚¹: 

- å¾ˆéš¾åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ•°ç»„æ˜¯å¦è¢«ç”¨ä½œå­—ç¬¦ä¸². 

- å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å¿…é¡»å°å¿ƒå¤„ç†ç©ºå­—ç¬¦. 

- ç¡®å®šå­—ç¬¦ä¸²çš„é•¿åº¦éœ€è¦æœç´¢ç©ºå­—ç¬¦. 



<!-- slide id="strvar" vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²å˜é‡

---

å¦‚æœå­—ç¬¦ä¸²å˜é‡éœ€è¦å­˜å‚¨ 80 ä¸ªå­—ç¬¦, åˆ™å¿…é¡»å°†å…¶å£°æ˜ä¸º 81: 
```C
#define STR_LEN 80
â€¦
char str[STR_LEN+1];
```

é•¿åº¦åŠ 1å¯ä»¥ä¸ºå­—ç¬¦ä¸²æœ«å°¾çš„ç©ºå­—ç¬¦ç•™å‡ºç©ºé—´. 

å®šä¹‰ä¸€ä¸ªä»£è¡¨ 80 çš„å®, ç„¶ååŠ  1 æ˜¯ä¸€ç§<u>æƒ¯ç”¨æ³•</u>. 



<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²å˜é‡

---

å£°æ˜å­—ç¬¦ä¸²å˜é‡æ—¶, è¯·åŠ¡å¿…ä¸ºç©ºå­—ç¬¦ç•™å‡ºç©ºé—´. 

ä¸è¿™æ ·åšå¯èƒ½ä¼šåœ¨ç¨‹åºæ‰§è¡Œæ—¶å¯¼è‡´ä¸å¯é¢„çŸ¥çš„ç»“æœ. 

å­—ç¬¦ä¸²çš„å®é™…é•¿åº¦å–å†³äºç»ˆæ­¢ç©ºå­—ç¬¦çš„ä½ç½®. 

STR_LEN + 1 é•¿åº¦çš„å­—ç¬¦æ•°ç»„å¯ä»¥ä¿å­˜é•¿åº¦ä¸º 0 ~ STR_LENä¹‹é—´çš„å­—ç¬¦ä¸². 



<!-- slide data-notes="" -->

##### åˆå§‹åŒ–å­—ç¬¦ä¸²å˜é‡

---

å­—ç¬¦ä¸²å˜é‡å¯ä»¥åœ¨å£°æ˜æ—¶åˆå§‹åŒ–: 

```C
char date1[8] = "June 14"; 
```

ç¼–è¯‘å™¨å°†è‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç©ºå­—ç¬¦, ä½¿date1å¯ä»¥ç”¨ä½œå­—ç¬¦ä¸²: 

<div class="top-2">
  <img src="img/14-3.png" height=100px>
</div>

"June  14"åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ä¸æ˜¯å­—ç¬¦ä¸²å­—é¢é‡. 

Cç¼–è¯‘å™¨å°†å…¶è§†ä¸ºå­—ç¬¦æ•°ç»„åˆå§‹åŒ–å¼çš„ç¼©å†™. 

---


<!-- slide vertical=true data-notes="" -->

##### åˆå§‹åŒ–å­—ç¬¦ä¸²å˜é‡

---

è‹¥åˆå§‹åŒ–å¼å¤ªçŸ­æ— æ³•å¡«æ»¡å­—ç¬¦ä¸²å˜é‡, ç¼–è¯‘å™¨ä¼šæ·»åŠ é¢å¤–ç©ºå­—ç¬¦: 

```C
char date2[9] = "June  14" ; 
```

ä¹‹å, date2å°†å¦‚ä¸‹æ‰€ç¤º: 

<div class="top-2">
  <img src="img/14-4.png" height=80px>
</div>

---


<!-- slide vertical=true data-notes="" -->

##### åˆå§‹åŒ–å­—ç¬¦ä¸²å˜é‡

---

å­—ç¬¦ä¸²å˜é‡çš„åˆå§‹åŒ–å¼ä¸èƒ½é•¿äºå˜é‡, ä½†é•¿åº¦å¯ä»¥ç›¸åŒ: 

```C
char date3[7] = "June 14";
```

å› ä¸ºæ²¡æœ‰ç»™ç©ºå­—ç¬¦ç•™ç©ºé—´, ç¼–è¯‘å™¨ä¸ä¼šå°è¯•å­˜å‚¨ç©ºå­—ç¬¦: 
<div class="top-2">
  <img src="img/14-5.png" height=100px>
</div>

---


<!-- slide vertical=true data-notes="" -->

##### åˆå§‹åŒ–å­—ç¬¦ä¸²å˜é‡

---

å­—ç¬¦ä¸²å˜é‡çš„å£°æ˜å¯çœç•¥é•¿åº¦, è¿™ç§æƒ…å†µä¸‹ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è®¡ç®—å®ƒ: 

```C
char date4[] = "June 14";
```

ç¼–è¯‘å™¨ä¸ºdate4åˆ†é…8ä¸ªå­—ç¬¦çš„ç©ºé—´, ä»¥å­˜å‚¨"June 14"+`'\0'`. 

å¦‚æœåˆå§‹åŒ–å¼å¾ˆé•¿, åˆ™çœç•¥å­—ç¬¦ä¸²å˜é‡çš„é•¿åº¦ç‰¹åˆ«æœ‰ç”¨, æ‰‹åŠ¨è®¡ç®—é•¿åº¦å®¹æ˜“å‡ºé”™. 

---


<!-- slide data-notes="" -->

##### å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦æŒ‡é’ˆ

---

ä»¥ä¸‹å£°æ˜å°†dateå£°æ˜ä¸ºä¸€ä¸ªæ•°ç»„: 

```C
char date[] = "June 14";
```

è€Œä»¥ä¸‹å£°æ˜åˆ™å°†dateå£°æ˜ä¸ºä¸€ä¸ªæŒ‡é’ˆ: 

```C
char *date = "June 14";
```

ç”±äºæ•°ç»„å’ŒæŒ‡é’ˆä¹‹é—´çš„å¯†åˆ‡å…³ç³», è¿™ä¸¤ç§éƒ½å¯ä»¥ç”¨ä½œå­—ç¬¦ä¸². 

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦æŒ‡é’ˆ

---

ä¸¤ç§dateä¹‹é—´å­˜åœ¨çš„å·®å¼‚: 

- å£°æ˜ä¸ºæ•°ç»„æ—¶, å¯ä»¥ä¿®æ”¹å­˜å‚¨åœ¨dateä¸­çš„å­—ç¬¦. å£°æ˜ä¸ºæŒ‡é’ˆæ—¶, dateæŒ‡å‘ä¸åº”ä¿®æ”¹çš„å­—ç¬¦ä¸²å­—é¢é‡. 

- å£°æ˜ä¸ºæ•°ç»„æ—¶, dateæ˜¯ä¸€ä¸ªæ•°ç»„å. å£°æ˜ä¸ºæŒ‡é’ˆæ—¶, dateæ˜¯ä¸€ä¸ªå¯ä»¥æŒ‡å‘å…¶ä»–å­—ç¬¦ä¸²çš„æŒ‡é’ˆå˜é‡. 

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦æŒ‡é’ˆ

---

å£°æ˜
```C
char *p;
```
ä¸ä¼šä¸ºå­—ç¬¦ä¸²åˆ†é…ç©ºé—´. 

åœ¨ä½¿ç”¨pä½œä¸ºå­—ç¬¦ä¸²ä¹‹å‰, å¿…é¡»æŠŠpæŒ‡å‘å­—ç¬¦æ•°ç»„. 

ä¸€ç§å¯èƒ½æ˜¯æŠŠpæŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡: 
```C
char str[STR_LEN+1], *p;
p = str;
```

å¦ä¸€ç§å¯èƒ½æ˜¯ä½¿pæŒ‡å‘ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„å­—ç¬¦ä¸². 

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦æ•°ç»„ä¸å­—ç¬¦æŒ‡é’ˆ

---

ä½¿ç”¨æœªåˆå§‹åŒ–çš„æŒ‡é’ˆå˜é‡ä½œä¸ºå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªä¸¥é‡çš„é”™è¯¯. 

å°è¯•åˆ›å»ºå­—ç¬¦ä¸²"abc": 

```C{.line-numbers}
char *p;

p[0] = 'a';    /*** WRONG ***/
p[1] = 'b';    /*** WRONG ***/
p[2] = 'c';    /*** WRONG ***/
p[3] = '\0';   /*** WRONG ***/
```

ç”±äºpå°šæœªåˆå§‹åŒ–, è¿™ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸º. 

---


<!-- slide data-notes="" -->

##### å­—ç¬¦ä¸²çš„è¯»å’Œå†™

---

ä½¿ç”¨printfæˆ–putså¯ä»¥å¾ˆç®€å•è¾“å‡ºå­—ç¬¦ä¸². 

è¯»å…¥å­—ç¬¦ä¸²åˆ™æ›´å›°éš¾, å› è¾“å…¥çš„ä¸²å¯èƒ½æ¯”å­˜å‚¨å®ƒçš„å­—ç¬¦ä¸²å˜é‡é•¿. 

è¦ä¸€æ¬¡æ€§è¯»å…¥å­—ç¬¦ä¸², å¯ä»¥ä½¿ç”¨scanfæˆ–gets. 

ä¹Ÿå¯ä»¥ä½¿ç”¨scanfæˆ–getcharæ¯æ¬¡è¯»å…¥ä¸€ä¸ªå­—ç¬¦. 

---


<!-- slide id="rwstr" vertical=true data-notes="" -->

##### ç”¨printfå’Œputså†™å­—ç¬¦ä¸²

---

è½¬æ¢è¯´æ˜ ==%s== å…è®¸printfè¾“å‡ºå­—ç¬¦ä¸²: 
```C
char str[] = "Are we having fun yet?";
printf("%s\n", str);
```

è¾“å‡ºå°†æ˜¯
`Are we having fun yet?`
printfä¼šé€ä¸ªå†™å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦, ç›´åˆ°é‡åˆ°ç©ºå­—ç¬¦. 

---


<!-- slide vertical=true data-notes="" -->

##### ç”¨printfå’Œputså†™å­—ç¬¦ä¸²

---

è¦æ‰“å°å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†, å¯ä»¥ä½¿ç”¨è½¬æ¢è¯´æ˜ ==%.ps==

==p== æ˜¯è¦æ‰“å°çš„å­—ç¬¦æ•°é‡. 

è¯­å¥
```C
printf("%.6s\n", str);
```
å°†æ‰“å°
`Are we`

---


<!-- slide vertical=true data-notes="" -->



##### ç”¨printfå’Œputså†™å­—ç¬¦ä¸²

---

è½¬æ¢è¯´æ˜ ==%ms== å°†åœ¨å¤§å°ä¸º ==m== çš„å­—æ®µå†…æ‰“å°å­—ç¬¦ä¸². 

å¦‚æœå­—ç¬¦ä¸²å°‘äº ==m== ä¸ªå­—ç¬¦, åˆ™ä¼šåœ¨å­—æ®µå†…å³å¯¹é½è¾“å‡º. 

å¦‚æœè¦å¼ºåˆ¶å·¦å¯¹é½, åœ¨må‰é¢åŠ ä¸€ä¸ªå‡å·. 

må’Œpå¯ä»¥ç»„åˆä½¿ç”¨: 

è½¬æ¢è¯´æ˜ ==%m.ps== ä¼šä½¿å­—ç¬¦ä¸²çš„å‰ ==p== ä¸ªå­—ç¬¦æ‰“å°åœ¨å¤§å°ä¸º ==m== çš„å­—æ®µä¸­. 

---


<!-- slide data-notes="" -->

##### ç”¨printfå’Œputså†™å­—ç¬¦ä¸²

---

printfä¸æ˜¯å”¯ä¸€å¯ä»¥è¾“å‡ºå­—ç¬¦ä¸²çš„å‡½æ•°. 

Cåº“è¿˜æä¾›puts: 

`puts(str);`

å†™å®Œä¸€ä¸ªå­—ç¬¦ä¸²å, putsæ€»æ˜¯ä¼šæ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ¢è¡Œç¬¦. 

---


<!-- slide vertical=true data-notes="" -->

##### ç”¨scanfå’Œgetsè¯»å­—ç¬¦ä¸²

---

è½¬æ¢è¯´æ˜ ==%s== å…è®¸scanfå°†å­—ç¬¦ä¸²è¯»å…¥å­—ç¬¦æ•°ç»„: 

`scanf("%s", str);`

strè¢«è§†ä¸ºæŒ‡é’ˆ, å› æ­¤æ— éœ€åœ¨strå‰æ·»åŠ `&`è¿ç®—ç¬¦. 

scanfä¼šè·³è¿‡ç©ºç™½å­—ç¬¦, ç„¶åè¯»å…¥å­—ç¬¦å¹¶å­˜å‚¨åˆ°strä¸­, ç›´åˆ°é‡åˆ°ç©ºç™½å­—ç¬¦. 

scanfä¼šåœ¨å­—ç¬¦ä¸²çš„æœ«å°¾å­˜å‚¨ä¸€ä¸ªç©ºå­—ç¬¦. 

---


<!-- slide vertical=true data-notes="" -->

##### ç”¨scanfå’Œgetsè¯»å­—ç¬¦ä¸²

---

scanfé€šå¸¸ä¸ä¼šè¯»å–æ•´è¡Œè¾“å…¥. 

æ¢è¡Œç¬¦ä¼šå¯¼è‡´scanfåœæ­¢è¯»å–, ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ä¹Ÿä¼š. 

è¦è¯»å–æ•´è¡Œè¾“å…¥, å¯ä»¥ä½¿ç”¨gets. 

getsçš„ç‰¹ç‚¹: 

- ä¸ä¼šåœ¨å¼€å§‹è¯»å­—ç¬¦ä¸²ä¹‹å‰è·³è¿‡ç©ºç™½å­—ç¬¦. 

- æŒç»­è¯»å…¥ç›´åˆ°æ‰¾åˆ°<u>æ¢è¡Œç¬¦</u>æ‰åœæ­¢. 

- å¿½ç•¥æ¢è¡Œç¬¦è€Œä¸å­˜å‚¨å®ƒ, ç”¨ç©ºå­—ç¬¦ä»£æ›¿æ¢è¡Œç¬¦. 

---



<!-- slide vertical=true data-notes="" -->

##### ç”¨scanfå’Œgetsè¯»å­—ç¬¦ä¸²

---

è€ƒè™‘ä»¥ä¸‹ç¨‹åºç‰‡æ®µ: 

```C{.line-numbers}
char sentence[SENT_LEN+1];
printf("Enter a sentence:\n");
scanf("%s", sentence);
```

å‡è®¾åœ¨æç¤ºä¹‹å
`Enter a sentence:`

ç”¨æˆ·è¾“å…¥è¯¥è¡Œ
$\quad$`To C, or not to C: that is the question.`

scanfä¼šå°†å­—ç¬¦ä¸²"To"å­˜å‚¨åˆ°sentenceä¸­. 

---


<!-- slide data-notes="" -->

##### ç”¨scanfå’Œgetsè¯»å­—ç¬¦ä¸²

---

å‡è®¾å°†scanfæ›¿æ¢ä¸ºgets: 

`gets(sentence);`

å½“ç”¨æˆ·è¾“å…¥ä¸ä¹‹å‰ç›¸åŒçš„è¾“å…¥æ—¶, getså°†å­˜å‚¨å­—ç¬¦ä¸²
`"  To C, or not to C: that is the question."`

å­˜å‚¨åˆ°sentenceä¸­. 

---


<!-- slide vertical=true data-notes="" -->

##### ç”¨scanfå’Œgetsè¯»å­—ç¬¦ä¸²

---

å½“æŠŠå­—ç¬¦è¯»å…¥æ•°ç»„æ—¶, scanfå’Œgetséƒ½æ— æ³•æ£€æµ‹æ•°ç»„ä½•æ—¶å·²æ»¡. 

å®ƒä»¬å­˜å‚¨å­—ç¬¦æ—¶å¯èƒ½ä¼šè¶Šè¿‡æ•°ç»„çš„è¾¹ç•Œ, ä»è€Œå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸º. 

ç”¨ ==%ns== ä»£æ›¿ ==%s== å¯ä»¥ä½¿scanfæ›´å®‰å…¨. 

==n== æ˜¯ä¸€ä¸ªæ•´æ•°, è¡¨ç¤ºè¦å­˜å‚¨çš„æœ€å¤§å­—ç¬¦æ•°. 

getsæœ¬è´¨ä¸Šæ˜¯ä¸å®‰å…¨çš„, fgetsæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©. 

---


<!-- slide vertical=true data-notes="" -->

##### é€ä¸ªå­—ç¬¦è¯»å­—ç¬¦ä¸²

---

ç¨‹åºå‘˜ç»å¸¸è‡ªå·±ç¼–å†™è¾“å…¥å‡½æ•°. éœ€è¦è€ƒè™‘çš„é—®é¢˜: 

- åœ¨å¼€å§‹å­˜å‚¨å­—ç¬¦ä¸²ä¹‹å‰, å‡½æ•°æ˜¯å¦åº”è¯¥è·³è¿‡ç©ºç™½å­—ç¬¦ï¼Ÿ

- ä»€ä¹ˆå­—ç¬¦ä¼šå¯¼è‡´å‡½æ•°åœæ­¢è¯»å–: æ¢è¡Œç¬¦ã€ä»»ä½•ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–å­—ç¬¦ï¼Ÿè¿™ä¸ªå­—ç¬¦æ˜¯å­˜å‚¨åœ¨å­—ç¬¦ä¸²ä¸­è¿˜æ˜¯è¢«ä¸¢å¼ƒï¼Ÿ

- å¦‚æœè¾“å…¥å­—ç¬¦ä¸²å¤ªé•¿è€Œæ— æ³•å­˜å‚¨, å‡½æ•°åº”è¯¥åšä»€ä¹ˆ: ä¸¢å¼ƒå¤šä½™çš„å­—ç¬¦æˆ–å°†å®ƒä»¬ç•™ç»™ä¸‹ä¸€æ¬¡è¾“å…¥æ“ä½œï¼Ÿ

---


<!-- slide vertical=true data-notes="" -->

##### é€ä¸ªå­—ç¬¦è¯»å­—ç¬¦ä¸²

---

å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°: 
(1)ä¸è·³è¿‡ç©ºç™½å­—ç¬¦; 
(2)åœ¨ç¬¬ä¸€ä¸ªæ¢è¡Œç¬¦å¤„åœæ­¢è¯»å–(ä¸å­˜å‚¨åˆ°å­—ç¬¦ä¸²ä¸­); 
(3)ä¸¢å¼ƒå¤šä½™çš„å­—ç¬¦. 

å‡½æ•°åŸå‹: `int read_line(char str[], int n);`

å¦‚æœè¾“å…¥è¡ŒåŒ…å«å¤šäºnä¸ªçš„å­—ç¬¦, read_lineå°†ä¸¢å¼ƒé¢å¤–çš„å­—ç¬¦. 

read_lineå°†è¿”å›å®é™…å­˜å‚¨åœ¨strä¸­çš„å­—ç¬¦æ•°é‡. 

---


<!-- slide data-notes="" -->

##### é€ä¸ªå­—ç¬¦è¯»å­—ç¬¦ä¸²

---

read_lineä¸»è¦ç”±ä¸€ä¸ªå¾ªç¯ç»„æˆ. åªè¦strä¸­è¿˜æœ‰ç©ºé—´, æ­¤å¾ªç¯å°±ä¼šè°ƒç”¨getcharé€ä¸ªè¯»å…¥å­—ç¬¦å¹¶å­˜å‚¨åˆ°strä¸­: 
```C{.line-numbers}
int read_line(char str[], int n)
{
  int ch, i = 0;
  
  while ((ch = getchar()) != '\n') {
    if (i < n)
      str[i++] = ch;
  }

  str[i] = '\0';   /* terminates string */
  return i;        /* number of characters stored */
}
```

chçš„ç±»å‹ä¸ºintè€Œä¸æ˜¯char, å› ä¸ºgetcharè¿”å›ä¸€ä¸ªintå€¼. 

---


<!-- slide vertical=true data-notes="" -->

##### é€ä¸ªå­—ç¬¦è¯»å­—ç¬¦ä¸²

---

åœ¨è¿”å›ä¹‹å‰, read_lineåœ¨å­—ç¬¦ä¸²æœ«å°¾æ”¾ç½®ä¸€ä¸ªç©ºå­—ç¬¦. 

æ ‡å‡†å‡½æ•°(ä¾‹å¦‚scanfå’Œgets)ä¼šè‡ªåŠ¨åœ¨è¾“å…¥å­—ç¬¦ä¸²çš„æœ«å°¾æ”¾ç½®ä¸€ä¸ªç©ºå­—ç¬¦. 

å¦‚æœè¦è‡ªå·±å†™è¾“å…¥å‡½æ•°, å¿…é¡»æ‰‹å·¥åŠ ä¸Šç©ºå­—ç¬¦. 



<!-- slide vertical=true data-notes="" -->

##### è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦

---

ç”±äºå­—ç¬¦ä¸²æ˜¯ä»¥æ•°ç»„çš„æ–¹å¼å­˜å‚¨çš„, å¯ä»¥ä½¿ç”¨ä¸‹æ ‡æ¥è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦. 

è¦å¤„ç†å­—ç¬¦ä¸²sä¸­çš„æ¯ä¸ªå­—ç¬¦, å¯ä»¥è®¾ç½®ä¸€ä¸ªå¾ªç¯æ¥å¯¹è®¡æ•°å™¨iè¿›è¡Œè‡ªå¢å¹¶é€šè¿‡è¡¨è¾¾å¼s[i]é€‰æ‹©å­—ç¬¦. 

---


<!-- slide id="accesscharinstr" vertical=true data-notes="" -->

##### è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦

---

è®¡ç®—å­—ç¬¦ä¸²ä¸­ç©ºæ ¼æ•°çš„å‡½æ•°: 

```C{.line-numbers}
int count_spaces(const char s[])
{
  int count = 0;

  for (int i = 0; s[i] != '\0'; i++) {
    if (s[i] == ' ')
      count++;
  }

  return count;
}
```

---

<!-- slide data-notes="" -->

##### è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦

---

ä½¿ç”¨æŒ‡é’ˆè¿ç®—ä»£æ›¿æ•°ç»„å–ä¸‹æ ‡: 

```C{.line-numbers}
int count_spaces(const char *s)
{
  int count = 0;

  for (; *s != '\0'; s++) {
    if (*s == ' ')
      count++;
  }

  return count;
}Â 
```

---


<!-- slide vertical=true data-notes="" -->

##### è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦

---

count_spacesç¤ºä¾‹å¼•å‡ºçš„é—®é¢˜: 

1. ç”¨æ•°ç»„æ“ä½œè¿˜æ˜¯æŒ‡é’ˆæ“ä½œæ¥è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼Ÿ

    *A*: å¯ä»¥ä½¿ç”¨ä»»æ„ä¸€ç§æ–¹æ³•. ä¼ ç»Ÿä¸Š, C ç¨‹åºå‘˜å€¾å‘äºä½¿ç”¨æŒ‡é’ˆæ“ä½œ. 

2. å­—ç¬¦ä¸²å½¢å¼å‚æ•°åº”è¯¥å£°æ˜ä¸ºæ•°ç»„è¿˜æ˜¯æŒ‡é’ˆï¼Ÿ

    *A*: ä¸¤è€…æ²¡æœ‰åŒºåˆ«. 

3. å½¢å¼å‚æ•°çš„å½¢å¼(s[]æˆ–*s)æ˜¯å¦ä¼šå¯¹å®é™…å‚æ•°äº§ç”Ÿå½±å“ï¼Ÿ
   
    *A*: ä¸ä¼š. 

---


<!-- slide vertical=true data-notes="" -->

##### ä½¿ç”¨Cè¯­è¨€çš„å­—ç¬¦ä¸²åº“å‡½æ•°

---

ä¸€äº›ç¼–ç¨‹è¯­è¨€æä¾›çš„è¿ç®—ç¬¦å¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œå¤åˆ¶ã€æ¯”è¾ƒã€æ‹¼æ¥ã€é€‰æ‹©ç­‰æ“ä½œ. 

ç›¸æ¯”ä¹‹ä¸‹, C çš„è¿ç®—ç¬¦æ— æ³•æ“ä½œå­—ç¬¦ä¸². 

å­—ç¬¦ä¸²åœ¨ C ä¸­è¢«è§†ä¸ºæ•°ç»„, å› æ­¤å¯¹å®ƒä»¬çš„é™åˆ¶æ–¹å¼ä¸æ•°ç»„ç›¸åŒ. 

ç‰¹åˆ«æ˜¯, å®ƒä»¬éƒ½ä¸èƒ½ä½¿ç”¨è¿ç®—ç¬¦è¿›è¡Œ==å¤åˆ¶==æˆ–==æ¯”è¾ƒ==. 



<!-- slide id="cstrlib" vertical=true data-notes="" -->

##### ä½¿ç”¨Cè¯­è¨€çš„å­—ç¬¦ä¸²åº“å‡½æ•°

---

ç›´æ¥å°è¯•å¤åˆ¶æˆ–æ¯”è¾ƒå­—ç¬¦ä¸²å°†å¤±è´¥. 

ä¸èƒ½ä½¿ç”¨`=`è¿ç®—ç¬¦å°†å­—ç¬¦ä¸²å¤åˆ¶åˆ°å­—ç¬¦æ•°ç»„ä¸­: 

```C{.line-numbers}
char str1[10], str2[10];
â€¦
str1 = "abc";  /*** WRONG ***/
str2 = str1;   /*** WRONG ***/
```

æŠŠæ•°ç»„åç”¨ä½œ`=`çš„å·¦æ“ä½œæ•°æ˜¯éæ³•çš„. 

ç”¨`=`åˆå§‹åŒ–å­—ç¬¦æ•°ç»„æ˜¯åˆæ³•çš„, åœ¨å£°æ˜ä¸­, `=`ä¸æ˜¯èµ‹å€¼è¿ç®—ç¬¦: 

```C
char str1[10] = "abc";
```

---


<!-- slide data-notes="" -->

##### ä½¿ç”¨Cè¯­è¨€çš„å­—ç¬¦ä¸²åº“å‡½æ•°

---

å°è¯•ä½¿ç”¨å…³ç³»æˆ–ç›¸ç­‰è¿ç®—ç¬¦æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯åˆæ³•çš„, ä½†ä¸ä¼šäº§ç”Ÿé¢„æœŸçš„ç»“æœ: 
```C
if (str1 == str2) â€¦   /*** WRONG ***/
```

è¯¥è¯­å¥å°†str1å’Œstr2ä½œä¸º ==æŒ‡é’ˆ== è¿›è¡Œæ¯”è¾ƒ. 

str1å’Œstr2æœ‰ä¸åŒçš„åœ°å€, è¡¨è¾¾å¼`str1 == str2`çš„å€¼ä¸€å®šä¸º0. 

---


<!-- slide vertical=true data-notes="" -->

##### ä½¿ç”¨Cè¯­è¨€çš„å­—ç¬¦ä¸²åº“å‡½æ•°

---

C åº“æä¾›äº†ä¸€ç»„ä¸°å¯Œçš„å‡½æ•°æ¥å¯¹å­—ç¬¦ä¸²æ‰§è¡Œæ“ä½œ. 

éœ€è¦å­—ç¬¦ä¸²æ“ä½œçš„ç¨‹åºåº”åŒ…å«ä»¥ä¸‹è¡Œ: 

`#include <string.h>`

åœ¨åç»­ç¤ºä¾‹ä¸­, å‡è®¾str1å’Œstr2æ˜¯ç”¨ä½œå­—ç¬¦ä¸²çš„å­—ç¬¦æ•°ç»„. 

---


<!-- slide vertical=true data-notes="" -->

##### strcpy(å­—ç¬¦ä¸²å¤åˆ¶)å‡½æ•°

---

strcpyå‡½æ•°çš„åŸå‹: 

`char *strcpy(char *s1, const char *s2);`

strcpyå°†å­—ç¬¦ä¸²s2å¤åˆ¶åˆ°å­—ç¬¦ä¸²s1ä¸­. 

å‡†ç¡®åœ°è¯´, strcpyå°† ==s2æŒ‡å‘çš„å­—ç¬¦ä¸²== å¤åˆ¶åˆ° ==s1æŒ‡å‘çš„æ•°ç»„ä¸­==. 

strcpyè¿”å›s1(æŒ‡å‘ç›®æ ‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆ). 

---


<!-- slide vertical=true data-notes="" -->

##### strcpy(å­—ç¬¦ä¸²å¤åˆ¶)å‡½æ•°

---

è°ƒç”¨strcpy, æŠŠå­—ç¬¦ä¸²"abcd"å­˜å‚¨åˆ°str2ä¸­: 

```C
strcpy(str2, "abcd");
/* str2 ç°åœ¨åŒ…å« "abcd" */
```

æŠŠstr2çš„å†…å®¹å¤åˆ¶åˆ°str1: 
```C
strcpy(str1, str2);
/* str1 ç°åœ¨åŒ…å« "abcd" */
```

--


<!-- slide data-notes="" -->

##### strcpy(å­—ç¬¦ä¸²å¤åˆ¶)å‡½æ•°

---

åœ¨strcpy(str1, str2)çš„è°ƒç”¨ä¸­, strcpyä¸ä¼šæ£€æŸ¥ä¹Ÿæ— æ³•æ£€æŸ¥str2æŒ‡å‘çš„å­—ç¬¦ä¸²çš„å¤§å°æ˜¯å¦é€‚åˆstr1æŒ‡å‘çš„æ•°ç»„. 

å¦‚æœä¸æ˜¯, åˆ™ä¼šäº§ç”Ÿæœªå®šä¹‰çš„è¡Œä¸º. 

---


<!-- slide vertical=true data-notes="" -->

##### strcpy(å­—ç¬¦ä¸²å¤åˆ¶)å‡½æ•°

---

è°ƒç”¨strncpyå‡½æ•°æ˜¯ä¸€ç§æ›´å®‰å…¨ä½†é€Ÿåº¦è¾ƒæ…¢çš„å¤åˆ¶å­—ç¬¦ä¸²çš„æ–¹æ³•. 

strncpyæœ‰ç¬¬ä¸‰ä¸ªå‚æ•°, å®ƒé™åˆ¶å°†è¢«å¤åˆ¶çš„å­—ç¬¦æ•°. 

æŠŠstr2å¤åˆ¶åˆ°str1çš„strncpyè°ƒç”¨: 

`strncpy(str1, str2, sizeof(str1));`

---


<!-- slide vertical=true data-notes="" -->

##### strcpy(å­—ç¬¦ä¸²å¤åˆ¶)å‡½æ•°

---

å¦‚æœstr2çš„é•¿åº¦å¤§äºæˆ–ç­‰äºstr1æ•°ç»„çš„å¤§å°, strncpyä¼šå¯¼è‡´str1ä¸­çš„å­—ç¬¦ä¸²æ²¡æœ‰ç»ˆæ­¢çš„ç©ºå­—ç¬¦. 

ä½¿ç”¨strncpyçš„æ›´å®‰å…¨æ–¹æ³•: 

```C
strncpy(str1, str2, sizeof(str1) - 1);
str1[sizeof(str1)-1] = '\0';
```

ç¬¬äºŒæ¡è¯­å¥ä¿è¯str1å§‹ç»ˆä»¥ç©ºå­—ç¬¦ç»“å°¾. 

---


<!-- slide vertical=true data-notes="" -->

##### strlen(å­—ç¬¦ä¸²é•¿åº¦)å‡½æ•°

---

strlenå‡½æ•°çš„åŸå‹: 

`size_t strlen(const char *s);`

size_tæ˜¯ä¸€ä¸ªtypedefåç§°, è¡¨ç¤ºCçš„ä¸€ç§æ— ç¬¦å·æ•´å‹. 

---


<!-- slide data-notes="" -->

##### strlen(å­—ç¬¦ä¸²é•¿åº¦)å‡½æ•°

---

strlenè¿”å›å­—ç¬¦ä¸²sçš„é•¿åº¦, ä¸åŒ…æ‹¬ç©ºå­—ç¬¦. ä¾‹å­: 

```C{.line-numbers}
int len;

len = strlen("abc");  /* len is now 3 */
len = strlen("");     /* len is now 0 */
strcpy(str1, "abc");
len = strlen(str1);   /* len is now 3 */
```

---


<!-- slide vertical=true data-notes="" -->

##### strcat(å­—ç¬¦ä¸²æ‹¼æ¥)å‡½æ•°

---

strcatå‡½æ•°çš„åŸå‹: 

`char *strcat(char *s1, const char *s2);`

strcatå°†å­—ç¬¦ä¸²s2çš„å†…å®¹é™„åŠ åˆ°å­—ç¬¦ä¸²s1çš„æœ«å°¾. 

å®ƒè¿”å›s1(æŒ‡å‘ç»“æœå­—ç¬¦ä¸²çš„æŒ‡é’ˆ). strcatç¤ºä¾‹: 

```C{.line-numbers}
char str1[20], str2[20];
strcpy(str1, "abc");
strcat(str1, "def");
 /* str1 now contains "abcdef" */
strcpy(str1, "abc");
strcpy(str2, "def");
strcat(str1, str2);
 /* str1 now contains "abcdef" */Â 
```

---


<!-- slide vertical=true data-notes="" -->

##### strcat(å­—ç¬¦ä¸²æ‹¼æ¥)å‡½æ•°

---

ä¸strcpyä¸€æ ·, strcatè¿”å›çš„å€¼é€šå¸¸ä¼šè¢«ä¸¢å¼ƒ. 

ä»¥ä¸‹ä½¿ç”¨è¿”å›å€¼çš„æ–¹æ³•: 

```C{.line-numbers}
char str1[20], str2[20];
strcpy(str1, "abc");
strcpy(str2, "def");
strcat(str1, strcat(str2, "ghi"));
/* str1 now contains "abcdefghi";
   str2 contains "defghi" */
```

---

<!-- slide vertical=true data-notes="" -->

##### strcat(å­—ç¬¦ä¸²æ‹¼æ¥)å‡½æ•°

---

å¦‚æœstr1æ•°ç»„çš„é•¿åº¦ä¸è¶³ä»¥å®¹çº³str2ä¸­çš„å­—ç¬¦, åˆ™è°ƒç”¨strcat(str1, str2)ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸º. 

ä¾‹å­: 
```C{.line-numbers}
char str1[6] = "abc";
strcat(str1, "def");   /*** WRONG ***/
```

str1è¢«é™åˆ¶ä¸ºå…­ä¸ªå­—ç¬¦, å¯¼è‡´strcatå†™å…¥è¶…å‡ºæ•°ç»„æœ«å°¾. 

---


<!-- slide data-notes="" -->

##### strcat(å­—ç¬¦ä¸²æ‹¼æ¥)å‡½æ•°

---

strncatå‡½æ•°æ˜¯strcatçš„ä¸€ä¸ªæ›´å®‰å…¨ä½†é€Ÿåº¦è¾ƒæ…¢çš„ç‰ˆæœ¬. 

åƒstrncpyä¸€æ ·, å®ƒæœ‰ç¬¬ä¸‰ä¸ªå‚æ•°æ¥é™åˆ¶å®ƒå°†å¤åˆ¶çš„å­—ç¬¦æ•°. 

è°ƒç”¨strncat: 

```C
strncat(str1, str2, sizeof(str1) - strlen(str1) - 1);
```

strncatå°†ä»¥ç©ºå­—ç¬¦ç»ˆæ­¢str1, è¯¥ç©ºå­—ç¬¦ä¸åŒ…å«åœ¨ç¬¬ä¸‰ä¸ªå‚æ•°ä¸­. 

---


<!-- slide vertical=true data-notes="" -->

##### strcmp(å­—ç¬¦ä¸²æ¯”è¾ƒ)å‡½æ•°

---

strcmpå‡½æ•°çš„åŸå‹: 

```C
int strcmp(const char *s1, const char *s2);
```

strcmpæ¯”è¾ƒå­—ç¬¦ä¸²s1å’Œs2, æ ¹æ®s1æ˜¯å°äºã€ç­‰äºè¿˜æ˜¯å¤§äºs2, è¿”å›ä¸€ä¸ªå°äºã€ç­‰äºæˆ–å¤§äº0çš„å€¼. 

---


<!-- slide vertical=true data-notes="" -->

##### strcmp(å­—ç¬¦ä¸²æ¯”è¾ƒ)å‡½æ•°

---

æ£€æŸ¥str1æ˜¯å¦å°äºstr2: 

```C
if (strcmp(str1, str2) < 0)    /* is str1 < str2? */
  â€¦
```

æ£€æŸ¥str1æ˜¯å¦å°äºæˆ–ç­‰äºstr2 : 

```C
if (strcmp(str1, str2) <= 0) /* is str1 <= str2? */
  â€¦
```

é€šè¿‡é€‰æ‹©é€‚å½“çš„è¿ç®—ç¬¦(<ã€ <=ã€ >ã€ >=ã€ ==ã€ !=), å¯ä»¥æµ‹è¯•str1å’Œstr2ä¹‹é—´çš„ä»»ä½•å¯èƒ½çš„å…³ç³». 

---


<!-- slide vertical=true data-notes="" -->

##### strcmp(å­—ç¬¦ä¸²æ¯”è¾ƒ)å‡½æ•°

---

strcmpè®¤ä¸ºs1å°äºs2çš„æƒ…å†µ: 

- s1å’Œs2çš„å‰iä¸ªå­—ç¬¦ä¸€è‡´, ä½†s1çš„ç¬¬i+1ä¸ªå­—ç¬¦å°äºs2çš„ç¬¬i+1ä¸ªå­—ç¬¦. 

- s1çš„æ‰€æœ‰å­—ç¬¦éƒ½ä¸s2ä¸€è‡´, ä½†s1æ¯”s2çŸ­. 

---


<!-- slide data-notes="" -->

##### strcmp(å­—ç¬¦ä¸²æ¯”è¾ƒ)å‡½æ•°

---

åœ¨æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²æ—¶, strcmpæŸ¥çœ‹å­—ç¬¦ä¸²ä¸­å­—ç¬¦å¯¹åº”çš„æ•°å€¼ç . 

ä¸€äº›åº•å±‚å­—ç¬¦é›†çš„çŸ¥è¯†æœ‰åŠ©äºé¢„æµ‹strcmpä¼šåšä»€ä¹ˆ. 

ASCIIçš„é‡è¦æ€§è´¨: 

- Aâ€“Zã€aâ€“z å’Œ 0â€“9 è¿™å‡ ç»„å­—ç¬¦çš„æ•°å€¼ç æ˜¯è¿ç»­çš„. 

- æ‰€æœ‰å¤§å†™å­—æ¯éƒ½å°äºå°å†™å­—æ¯. 

- æ•°å­—å°äºå­—æ¯. 

- ç©ºæ ¼å°äºæ‰€æœ‰æ‰“å°å­—ç¬¦. 

---


<!-- slide vertical=true data-notes="" -->

##### ç¨‹åº: æ‰“å°ä¸€ä¸ªæœˆçš„æé†’åˆ—è¡¨

---

*remind.c*ç¨‹åºæ‰“å°ä¸€ä¸ªæœˆçš„æ¯æ—¥æé†’åˆ—è¡¨. 

ç”¨æˆ·å°†è¾“å…¥ä¸€ç³»åˆ—æé†’, æ¯ä¸ªæé†’æœ‰ä¸€ä¸ªå‰ç¼€è¯´æ˜æ˜¯ä¸€ä¸ªæœˆä¸­çš„å“ªä¸€å¤©. 

å½“ç”¨æˆ·è¾“å…¥ 0 è€Œä¸æ˜¯æœ‰æ•ˆæ—¥æœŸæ—¶, ç¨‹åºå°†æ‰“å°è¾“å…¥çš„æ‰€æœ‰æé†’çš„åˆ—è¡¨, æŒ‰æ—¥æœŸæ’åº. 

ä¸‹ä¸€å¼ å¹»ç¯ç‰‡æ˜¾ç¤ºäº†è¯¥ç¨‹åºçš„ä¼šè¯. 

---


<!-- slide vertical=true data-notes="" -->

##### ç¨‹åº: æ‰“å°ä¸€ä¸ªæœˆçš„æé†’åˆ—è¡¨

---

```
Enter day and reminder: 24 Susan's birthday
Enter day and reminder: 5 6:00 - Dinner with Marge and Russ
Enter day and reminder: 26 Movie - "Chinatown"
Enter day and reminder: 7 10:30 - Dental appointment
Enter day and reminder: 12 Movie - "Dazed and Confused"
Enter day and reminder: 5 Saturday class
Enter day and reminder: 12 Saturday class
Enter day and reminder: 0
Â 
Day Reminder
  5 Saturday class
  5 6:00 - Dinner with Marge and Russ
  7 10:30 - Dental appointment
 12 Saturday class
 12 Movie - "Dazed and Confused"
 24 Susan's birthday
 26 Movie - "Chinatown"
```

---



<!-- slide vertical=true data-notes="" -->

##### ç¨‹åº: æ‰“å°ä¸€ä¸ªæœˆçš„æé†’åˆ—è¡¨

---

æ€»ä½“ç­–ç•¥: 

- è¯»å…¥ä¸€ç³»åˆ—æ—¥æœŸå’Œæé†’çš„ç»„åˆ

- æŒ‰é¡ºåºå­˜å‚¨(æŒ‰æ—¥æœŸæ’åº)

- æ˜¾ç¤º

scanfå°†ç”¨äºè¯»å–æ—¥æœŸ. 

read_lineå°†ç”¨äºè¯»å…¥æé†’. 

---



<!-- slide data-notes="" -->

##### ç¨‹åº: æ‰“å°ä¸€ä¸ªæœˆçš„æé†’åˆ—è¡¨

---

å­—ç¬¦ä¸²å°†å­˜å‚¨åœ¨ä¸€ä¸ªäºŒç»´å­—ç¬¦æ•°ç»„ä¸­. 

æ•°ç»„çš„æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸². 

ç¨‹åºè¯»å–æ—¥æœŸä»¥åŠç›¸å…³æé†’åé‡‡å–çš„è¡ŒåŠ¨: 

- ä½¿ç”¨strcmpè¿›è¡Œæ¯”è¾ƒæ¥æŸ¥æ‰¾æ•°ç»„ä»¥ç¡®å®šè¿™ä¸€å¤©æ‰€åœ¨çš„ä½ç½®. 

- ä½¿ç”¨strcpyå°†è¯¥ä½ç½®ä¹‹åçš„æ‰€æœ‰å­—ç¬¦ä¸²å¾€åç§»åŠ¨ä¸€ä¸ªä½ç½®. 

- å°†è¿™ä¸€å¤©å¤åˆ¶åˆ°æ•°ç»„ä¸­, å¹¶è°ƒç”¨strcatå°†æé†’é™„åŠ åˆ°è¿™ä¸€å¤©ä¹‹å. 

---



<!-- slide vertical=true data-notes="" -->

##### ç¨‹åº: æ‰“å°ä¸€ä¸ªæœˆçš„æé†’åˆ—è¡¨

---

ä¸€ä¸ªå¤æ‚çš„é—®é¢˜: å¦‚ä½•åœ¨ä¸¤ä¸ªå­—ç¬¦çš„å­—æ®µä¸­å³å¯¹é½æ—¥æœŸ. 

è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨scanfå°†æ—¥æœŸè¯»å…¥åˆ°æ•´æ•°å˜é‡, ç„¶åè°ƒç”¨sprintfå°†æ—¥æœŸè½¬æ¢å›å­—ç¬¦ä¸²å½¢å¼. 

sprintfç±»ä¼¼äºprintf, ä¸åŒä¹‹å¤„åœ¨äºå®ƒå°†è¾“å‡ºå†™å…¥å­—ç¬¦ä¸². è°ƒç”¨

```C
sprintf(day_str, "%2d", day);
```

æŠŠdayçš„å€¼å†™å…¥day_str. 

---


<!-- slide vertical=true data-notes="" -->

##### ç¨‹åº: æ‰“å°ä¸€ä¸ªæœˆçš„æé†’åˆ—è¡¨

---

ä»¥ä¸‹scanfè°ƒç”¨å¯ç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ•°å­—ä¸è¶…è¿‡ä¸¤ä½: 

`scanf("%2d", &day);`

---



<!-- slide data-notes="" -->

##### *remind.c*

---

```C{.line-numbers}
/* Prints a one-month reminder list */
Â 
#include <stdio.h>
#include <string.h>
Â 
#define MAX_REMIND 50   /* maximum number of reminders */
#define MSG_LEN 60      /* max length of reminder message */
Â 
int read_line(char str[], int n);

int main(void)
{
  char reminders[MAX_REMIND][MSG_LEN+3];
  char day_str[3], msg_str[MSG_LEN+1];
  int day, i, j, num_remind = 0;
Â 
  for (;;) {
    if (num_remind == MAX_REMIND) {
      printf("-- No space left --\n");
      break;
    }
    printf("Enter day and reminder: ");
    scanf("%2d", &day);
    if (day == 0)
      break;
    
    sprintf(day_str, "%2d", day);
    read_line(msg_str, MSG_LEN);

    for (i = 0; i < num_remind; i++)
      if (strcmp(day_str, reminders[i]) < 0)
        break;
    for (j = num_remind; j > i; j--)
      strcpy(reminders[j], reminders[j-1]);

    strcpy(reminders[i], day_str);
    strcat(reminders[i], msg_str);

    num_remind++;
  }

  printf("\nDay Reminder\n");
  for (i = 0; i < num_remind; i++)
    printf(" %s\n", reminders[i]);

  return 0;
}

int read_line(char str[], int n)
{
  int ch, i = 0;

  while ((ch = getchar()) != '\n') {
    if (i < n)
      str[i++] = ch;
  }

  str[i] = '\0';
  return i;
}
```

---

<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²æƒ¯ç”¨æ³•

---

å¤„ç†å­—ç¬¦ä¸²çš„å‡½æ•°æ˜¯ç‰¹åˆ«ä¸°å¯Œçš„æƒ¯ç”¨æ³•èµ„æº. 

æ¢ç´¢ä¸€äº›æœ€è‘—åçš„æƒ¯ç”¨æ³•æ¥ç¼–å†™strlenå’Œstrcatå‡½æ•°. 

---


<!-- slide id="stridioms" vertical=true data-notes="" -->

##### æœç´¢å­—ç¬¦ä¸²çš„ç»“å°¾

---

strlenç‰ˆæœ¬, ä½¿ç”¨å˜é‡æ¥è·Ÿè¸ªå­—ç¬¦ä¸²çš„é•¿åº¦: 

```C{.line-numbers}
size_t strlen(const char *s)
{
  size_t n;

  for (n = 0; *s != '\0'; s++)
    n++;

  return n;
}
```

---


<!-- slide vertical=true data-notes="" -->

##### æœç´¢å­—ç¬¦ä¸²çš„ç»“å°¾

---

nçš„åˆå§‹åŒ–ç§»åˆ°å®ƒçš„å£°æ˜ä¸­: 

```C{.line-numbers}
size_t strlen(const char *s)
{
  size_t n = 0;

  for (; *s != '\0'; s++) {
    n++;
  }

  return n;
}
```

---


<!-- slide data-notes="" -->

##### æœç´¢å­—ç¬¦ä¸²çš„ç»“å°¾

---

æ¡ä»¶`*s != '\0'`ä¸`*s != 0`ç›¸åŒ, è¿™åˆä¸`*s`ç›¸åŒ. 

ä½¿ç”¨è¿™äº›è§‚å¯Ÿçš„strlenç‰ˆæœ¬: 

```C{.line-numbers}
size_t strlen(const char *s)
{
  size_t n = 0;

  for (; *s; s++) {
    n++;
  }

  return n;
}
```

---



<!-- slide vertical=true data-notes="" -->

##### æœç´¢å­—ç¬¦ä¸²çš„ç»“å°¾

---

å¯¹sè¿›è¡Œè‡ªå¢å¹¶åœ¨åŒä¸€ä¸ªè¡¨è¾¾å¼ä¸­æµ‹è¯•`*s`: 

```C{.line-numbers}
size_t strlen(const char *s)
{
  size_t n = 0;

  for (; *s++;){
    n++;
  }

  return n;
}Â 
```

---


<!-- slide vertical=true data-notes="" -->

##### æœç´¢å­—ç¬¦ä¸²çš„ç»“å°¾

---

ç”¨whileè¯­å¥æ›¿æ¢forè¯­å¥, ä¼šç»™å‡ºä»¥ä¸‹ç‰ˆæœ¬çš„strlen: 

```C{.line-numbers}
size_t strlen(const char *s)
{
  size_t n = 0;

  while (*s++) {
    n++;
  }

  return n;
}
```

---



<!-- slide vertical=true data-notes="" -->

##### æœç´¢å­—ç¬¦ä¸²çš„ç»“å°¾

---

å°½ç®¡æˆ‘ä»¬å·²ç»å¯¹strlenè¿›è¡Œäº†ç›¸å½“å¤šçš„ç²¾ç®€, ä½†å¾ˆå¯èƒ½ä»ç„¶æ²¡æœ‰æé«˜å®ƒçš„é€Ÿåº¦. 

åœ¨æŸäº›ç¼–è¯‘å™¨ä¸­, ä¸€ä¸ªè¿è¡Œé€Ÿåº¦æ›´å¿«çš„ç‰ˆæœ¬: 

```C{.line-numbers}
size_t strlen(const char *s)
{
  const char *p = s;

  while (*s)
    s++;

  return s - p;
}
```

---



<!-- slide data-notes="" -->

##### æœç´¢å­—ç¬¦ä¸²çš„ç»“å°¾

---

"æœç´¢åœ¨å­—ç¬¦ä¸²ç»“å°¾çš„ç©ºå­—ç¬¦"çš„æƒ¯ç”¨æ³•: 

ç¬¬ä¸€ä¸ªç‰ˆæœ¬è®©sæœ€ç»ˆæŒ‡å‘ç©ºå­—ç¬¦. 

```C
while (*s)
  s++;
```

ç¬¬äºŒä¸ªç‰ˆæœ¬æ›´ç®€æ´, ä½†sæœ€ç»ˆæŒ‡å‘ç©ºå­—ç¬¦åé¢çš„ä½ç½®. 

```C
while (*s++)
  ;
```

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

å¤åˆ¶å­—ç¬¦ä¸²æ˜¯å¦ä¸€ç§å¸¸è§çš„æ“ä½œ. 

ä¸ºäº†ä»‹ç»Cçš„"å­—ç¬¦ä¸²å¤åˆ¶"æƒ¯ç”¨æ³•, å°†å¼€å‘ä¸¤ä¸ªç‰ˆæœ¬çš„strcatå‡½æ•°. 

strcatçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä½¿ç”¨ä¸¤æ­¥ç®—æ³•: 

1. ç¡®å®šs1æœ«å°¾ç©ºå­—ç¬¦çš„ä½ç½®, å¹¶è®©pæŒ‡å‘å®ƒ. 

2. å°†å­—ç¬¦ä»s2é€ä¸ªå¤åˆ¶åˆ°pæŒ‡å‘çš„ä½ç½®. 

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

```C{.line-numbers}
char *strcat(char *s1, const char *s2) 
{
  char *p = s1;

  while (*p != '\0')
    p++;

  while (*s2 != '\0') {
    *p = *s2;
    p++;
    s2++;
  }
  *p = '\0';
  return s1;
}
```

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

pæœ€åˆæŒ‡å‘s1å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦: 

<div class="top-2">
  <img src="img/14-6.png">
</div>

---



<!-- slide data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

ç¬¬ä¸€ä¸ªwhileè¯­å¥å®šä½s1æœ«å°¾çš„ç©ºå­—ç¬¦å¹¶è®©pæŒ‡å‘å®ƒ: 

<div class="top-2">
  <img src="img/14-7.png">
</div>

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

ç¬¬äºŒä¸ªwhileè¯­å¥é‡å¤å°†s2æŒ‡å‘ä¸€ä¸ªå­—ç¬¦å¤åˆ¶åˆ°pæŒ‡å‘çš„ä½ç½®, ç„¶åpå’Œs2è‡ªå¢. 

å‡è®¾s2æœ€åˆæŒ‡å‘å­—ç¬¦ä¸²"def". 

ç¬¬ä¸€æ¬¡å¾ªç¯è¿­ä»£åçš„å­—ç¬¦ä¸²: 

<div class="top-2">
  <img src="img/14-8.png">
</div>

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

å½“s2æŒ‡å‘ç©ºå­—ç¬¦æ—¶, å¾ªç¯ç»ˆæ­¢: 

<div class="top-2">
  <img src="img/14-9.png">
</div>

åœ¨pæŒ‡å‘çš„ä½ç½®æ”¾ç½®ä¸€ä¸ªç©ºå­—ç¬¦å, strcatè¿”å›. 

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

strcatçš„ç²¾ç®€ç‰ˆ: 

```C{.line-numbers}
char *strcat(char *s1, const char *s2) 
{
  char *p = s1;

  while (*p)
    p++;

  while (*p++ = *s2++)
    ;

  return s1;
}
```

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

strcatçš„ç²¾ç®€ç‰ˆ(å­˜åœ¨`ç¼ºé™·`): 

```C{.line-numbers}
char *strcat(char *s1, const char *s2) 
{
  char *p = s1;

  /*
  while (*p)
    p++;
    */
  while (*p++)
    ;

  while (*p++ = *s2++)
    ;

  return s1;
}
```

---



<!-- slide data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

æ”¹è¿›çš„strcatå‡½æ•°çš„æ ¸å¿ƒæ˜¯"å­—ç¬¦ä¸²å¤åˆ¶"æƒ¯ç”¨æ³•: 

```C
while (*p++ = *s2++)
 ;
```

å¿½ç•¥ä¸¤ä¸ª++è¿ç®—ç¬¦, æ‹¬å·å†…çš„è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªèµ‹å€¼: 

```C
*p = *s2
```

èµ‹å€¼å, på’Œs2è‡ªå¢. 

é‡å¤è®¡ç®—æ­¤è¡¨è¾¾å¼ä¼šå°†å­—ç¬¦ä»s2æŒ‡å‘çš„ä½ç½®å¤åˆ¶åˆ°pæŒ‡å‘çš„ä½ç½®. 

---



<!-- slide vertical=true data-notes="" -->

##### å¤åˆ¶å­—ç¬¦ä¸²

---

ä½†æ˜¯æ˜¯ä»€ä¹ˆå¯¼è‡´å¾ªç¯ç»ˆæ­¢ï¼Ÿ

whileè¯­å¥æµ‹è¯•èµ‹å€¼è¡¨è¾¾å¼*p = *s2çš„å€¼, ä¹Ÿå°±æ˜¯æµ‹è¯•å¤åˆ¶çš„å­—ç¬¦. 

é™¤ç©ºå­—ç¬¦å¤–çš„æ‰€æœ‰å­—ç¬¦éƒ½æµ‹è¯•ä¸ºçœŸ. 

å¤åˆ¶ç©ºå­—ç¬¦åå¾ªç¯ç»ˆæ­¢, å› æ­¤ä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ ç©ºå­—ç¬¦. 

---



<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²æ•°ç»„

---

å­˜å‚¨å­—ç¬¦ä¸²æ•°ç»„çš„æ–¹æ³•ä¸æ­¢ä¸€ç§. 

ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨äºŒç»´å­—ç¬¦æ•°ç»„, æ¯è¡Œä¸€ä¸ªå­—ç¬¦ä¸²: 
```C
char planets[][8] = {"Mercury", "Venus", "Earth",
                     "Mars", "Jupiter", "Saturn",
                     "Uranus", "Neptune", "Pluto"};
```

æ•°ç»„ä¸­çš„è¡Œæ•°å¯ä»¥çœç•¥, ä½†å¿…é¡»æŒ‡å®šåˆ—æ•°. 

<!-- slide id="strarr" vertical=true data-notes="" -->



##### å­—ç¬¦ä¸²æ•°ç»„

---

ä¸å¹¸çš„æ˜¯, planetsæ•°ç»„æµªè´¹äº†ç›¸å½“å¤šçš„ç©ºé—´(é¢å¤–çš„ç©ºå­—ç¬¦): 

<div class="top-2">
  <img src="img/14-10.png">
</div>

---



<!-- slide data-notes="" -->

##### å­—ç¬¦ä¸²æ•°ç»„

---

å¤§å¤šæ•°å­—ç¬¦ä¸²é›†åˆéƒ½æ˜¯é•¿å­—ç¬¦ä¸²å’ŒçŸ­å­—ç¬¦ä¸²çš„æ··åˆ. 

æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªå‚å·®ä¸é½çš„æ•°ç»„, å®ƒçš„è¡Œå¯ä»¥æœ‰ä¸åŒçš„é•¿åº¦. 

ç”¨æŒ‡å‘ ==å­—ç¬¦ä¸²çš„æŒ‡é’ˆçš„æ•°ç»„== æ¥æ¨¡æ‹Ÿ C ä¸­çš„ä¸è§„åˆ™æ•°ç»„: 

```C
char *planets[] = {"Mercury", "Venus", "Earth",
                   "Mars", "Jupiter", "Saturn",
                   "Uranus", "Neptune", "Pluto"};
```

---



<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²æ•°ç»„

---

è¿™ä¸ªå¾®å°çš„å˜åŒ–å¯¹planetsçš„å­˜å‚¨æ–¹å¼äº§ç”Ÿäº†å·¨å¤§çš„å½±å“: 

<div class="top-2">
  <img src="img/14-11.png">
</div>

---


<!-- slide vertical=true data-notes="" -->

##### å­—ç¬¦ä¸²æ•°ç»„

---

è¦è®¿é—®å…¶ä¸­ä¸€ä¸ªè¡Œæ˜Ÿçš„åç§°, åªéœ€è¦å¯¹planetsæ•°ç»„å–ä¸‹æ ‡. 

è®¿é—®è¡Œæ˜Ÿåç§°ä¸­çš„å­—ç¬¦ä¸è®¿é—®äºŒç»´æ•°ç»„å…ƒç´ çš„æ–¹å¼ç›¸åŒ. 

åœ¨planetsæ•°ç»„ä¸­æœç´¢ä»¥å­—æ¯ M å¼€å¤´çš„å­—ç¬¦ä¸²çš„å¾ªç¯: 

```C{.line-numbers}
for (i = 0; i < 9; i++)
  if (planets[i][0] == 'M')
    printf("%s begins with M\n", planets[i]);
```

---



<!-- slide vertical=true data-notes="" -->

##### å‘½ä»¤è¡Œå‚æ•°

---

è¿è¡Œç¨‹åºæ—¶, ç»å¸¸éœ€è¦æä¾›ä¸€äº›ä¿¡æ¯. 

è¿™å¯èƒ½åŒ…æ‹¬æ–‡ä»¶åæˆ–ä¿®æ”¹ç¨‹åºè¡Œä¸ºçš„å¼€å…³. 

UNIX `ls`å‘½ä»¤çš„ç¤ºä¾‹: 

```
ls
ls â€“l
ls -l remind.c
```

---

<!-- slide data-notes="" -->

##### æŒ‡é’ˆplus

---

```C
    int var = 10;

    // Pointer to int
    int *ptr1 = &var;

    // Pointer to pointer (double pointer)
    int **ptr2 = &ptr1;
```

<img src="figs/double-pointers-in-c.webp">

[double_pointer.c](./code/double_pointer.c)

---


<!-- slide data-notes="" -->

##### æŒ‡é’ˆPlusï¼ˆåŒé‡æŒ‡é’ˆï¼‰

---

```C
int val = 10;
int* ptr = &val;
*ptr = 20;

int** double_ptr = &ptr;
**double_ptr = 30;
```

<img src="figs/PointersinC.png">

---


<!-- slide data-notes="" -->

##### å‘½ä»¤è¡Œå‚æ•°

---

å‘½ä»¤è¡Œä¿¡æ¯å¯¹æ‰€æœ‰ç¨‹åºéƒ½æ˜¯å¯ç”¨çš„, ä¸ä»…ä»…æ˜¯æ“ä½œç³»ç»Ÿå‘½ä»¤. 

è¦è®¿é—® ==å‘½ä»¤è¡Œå‚æ•°==, mainå¿…é¡»å«æœ‰ä¸¤ä¸ªå‚æ•°: 
```C
int main(int argc, char *argv[])
{
  â€¦
}
```

å‘½ä»¤è¡Œå‚æ•°åœ¨ C æ ‡å‡†ä¸­ç§°ä¸º ==ç¨‹åºå‚æ•°==. 

---



<!-- slide vertical=true data-notes="" -->

##### å‘½ä»¤è¡Œå‚æ•°

---

argc: (argument count)å‚æ•°è®¡æ•°æ˜¯å‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡. 

argv: (argument vector)å‚æ•°å‘é‡æ˜¯æŒ‡å‘å‘½ä»¤è¡Œå‚æ•°çš„æŒ‡é’ˆæ•°ç»„(ä»¥å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨). 

argv[0]æŒ‡å‘ç¨‹åºå, è€Œargv[1]åˆ°argv[argc-1]æŒ‡å‘å‰©ä½™çš„å‘½ä»¤è¡Œå‚æ•°. 

argv[argc]æ€»æ˜¯ä¸€ä¸ªç©ºæŒ‡é’ˆâ€”â€”ä¸€ä¸ªä¸æŒ‡å‘ä»»ä½•ä¸œè¥¿çš„ç‰¹æ®ŠæŒ‡é’ˆ. 

å®NULLè¡¨ç¤ºä¸€ä¸ªç©ºæŒ‡é’ˆ. 

---



<!-- slide vertical=true data-notes="" -->

##### å‘½ä»¤è¡Œå‚æ•°

---

å¦‚æœç”¨æˆ·è¾“å…¥å‘½ä»¤è¡Œ

`ls -l remind.c`

é‚£ä¹ˆargcå°†ä¸º 3, è€Œargvå°†å¦‚ä¸‹: 

<div class="top-2">
  <img src="img/14-12.png">
</div>

---



<!-- slide vertical=true data-notes="" -->

##### å‘½ä»¤è¡Œå‚æ•°

---

ç”±äºargvæ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„, è®¿é—®å‘½ä»¤è¡Œå‚æ•°å¾ˆå®¹æ˜“. 

é€šå¸¸, éœ€è¦å‘½ä»¤è¡Œå‚æ•°çš„ç¨‹åºä¼šä½¿ç”¨å¾ªç¯, ä¾æ¬¡æ£€æŸ¥æ¯ä¸ªå‚æ•°. 

ä¸€ç§æ–¹æ³•æ˜¯å¾ªç¯: ä½¿ç”¨ä¸€ä¸ªæ•´æ•°å˜é‡ä½œä¸ºargvæ•°ç»„çš„ç´¢å¼•: 

```C{.line-number}
int i;

for (i = 1; i < argc; i++)
  printf("%s\n", argv[i]);
```

---




<!-- slide data-notes="" -->

##### å‘½ä»¤è¡Œå‚æ•°

---

å¦ä¸€ç§æ–¹æ³•æ˜¯æ„é€ æŒ‡å‘argv[1]çš„æŒ‡é’ˆ, ç„¶åé‡å¤è‡ªå¢æŒ‡é’ˆ: 

```C{.line-number}
char **p;

for (p = &argv[1]; *p != NULL; p++)
  printf("%s\n", *p);
```

---



<!-- slide vertical=true data-notes="" -->

##### ç¨‹åº: æ£€æŸ¥è¡Œæ˜Ÿåç§°

---

*planet.c*ç¨‹åºè¯´æ˜äº†å¦‚ä½•è®¿é—®å‘½ä»¤è¡Œå‚æ•°. 

è¯¥ç¨‹åºæ—¨åœ¨æ£€æŸ¥ä¸€ç³»åˆ—å­—ç¬¦ä¸², æ‰¾å‡ºå“ªäº›å“ªäº›æ˜¯è¡Œæ˜Ÿçš„åç§°. 

å­—ç¬¦ä¸²æ”¾åœ¨å‘½ä»¤è¡Œä¸­: 

`planet Jupiter venus Earth fred`

è¯¥ç¨‹åºå°†æŒ‡ç¤ºæ¯ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯è¡Œæ˜Ÿåç§°, å¦‚æœæ˜¯, æ˜¾ç¤ºè¡Œæ˜Ÿçš„ç¼–å·: 

```
Jupiter is planet 5
venus is not a planet
Earth is planet 3
fred is not a planet
```

---



<!-- slide vertical=true data-notes="" -->

##### *planet.c*

---

```C{.line-numbers}
/* Checks planet names */

#include <stdio.h>
#include <string.h>

#define NUM_PLANETS 9

int main(int argc, char *argv[])
{
  char *planets[] = {"Mercury", "Venus", "Earth",
                     "Mars", "Jupiter", "Saturn",
                     "Uranus", "Neptune", "Pluto"};
  int i, j;
  for (i = 1; i < argc; i++) {
    for (j = 0; j < NUM_PLANETS; j++) {
      if (strcmp(argv[i], planets[j]) == 0) {
        printf("%s is planet %d\n", argv[i], j + 1);
        break;
      }
    }

    if (j == NUM_PLANETS) {
      printf("%s is not a planet\n", argv[i]);
    }
  }

  return 0;
}
```

---



<!-- slide vertical=true data-notes="" -->

##### string.h

---

å¸¸è§çš„å­—ç¬¦ä¸²å‡½æ•°

- ä¸å—é™åˆ¶çš„å­—ç¬¦ä¸²å‡½æ•°
```C
size_t strlen (char const *string);
char *strcpy (char *dst, char const *src);
char *strcat (char *dst, char const *src);
int strcmp (char const *s1, char const *s2);
```

- é•¿åº¦å—é™çš„å­—ç¬¦ä¸²å‡½æ•°
```C
char *strncpy (char *dst, char const *src, size_t len);
char *strncat (char *dst, char const *src, size_t len);
int strncmp (char const *s1, char const *s2, size_t len);
```

---



<!-- slide vertical=true data-notes="" -->

##### string.h

---

å¸¸è§çš„å­—ç¬¦ä¸²å‡½æ•°

- æŸ¥æ‰¾å­—ç¬¦æˆ–å­ä¸²å‡½æ•°
```C
char *strchr(char const *str, int ch);
char *strrchr(char const *str, int ch);
char *strpbrk(char const *str, char const *group);
char *strstr(char const *s1, char const *s2);
```

- æŸ¥æ‰¾è®¡æ•°
```C
size_t *strspn(char const *str, char const *group);
size_t *strcspn(char const *str, char const *group);
```

- æŸ¥æ‰¾æ ‡è®°
```C
char *strtok(char *str, char const *sep);
```

---
